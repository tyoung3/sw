#!/bin/bash 

# SWGRAPH  script.  Generate a jpg image from  a StreamWork .sw file(ND).

Die () {
	echo "$0/DIE: $*"
	exit 1
}

version=v0.0.1

Debug() {
	[ "$DEBUG" == "y" ]  	\
	&&echo SWGRAPH/DEBUG: $* 
}

swdir=./model
[ -e $swdir/sw ] || swdir=/usr/local/bin
SW=$swdir/sw
[ -e $SW     ] || Die $SW is missing 
$SW -v 

searchFile() { 
	Debug SearchFIle $*
	base=`basename $file`
	swfile=${base}
	
	if [ ! -f $swfile ]; then
		[ -f /home/tyoung3/go/src/github.com/tyoung3/sw/nds/${swfile}.sw ] \
			&& swfile=/home/tyoung3/go/src/github.com/tyoung3/sw/nds/${swfile}.sw
		[ -f $swfile ] || swfile=${file}.sw
	fi	
}

GenRun() {
	Debug GenRun  $file $*
	swfile=$file
	[ -f $file ] || searchFile  
	base=`basename $file .sw`
	
	if [ -f $swfile ]; then
		Debug Got `pwd`/$swfile 
		$SW -m 3 $swfile > /tmp/${base}.dot || Die Cannot build /tmp/${base}.dot file 
		dot -Tsvg /tmp/${base}.dot > /tmp/${base}.svg || Die Cannot convert /tmp/${base}.dot file to .svg
		Debug Built /tmp/${base}.dot and /tmp/${base}.svg
		$BROWSER  /tmp/${base}.svg 2>&1  >/dev/null	&
	else 
		Die $swfile missing
	fi
}

Run() {	
	for file in $*; do 
		GenRun $file
	done 
}


Usage(){
	cat <<- EOF
	
	swgraph-$version Usage:
 	swgraph [SW_file...]   . Generate .svg file(s) and browse them with $BROWSER.
 	swgraph				   . Show this usage
		
EOF
}


case $# in 
	0)Usage;;
	*)Run $*;;
	
esac	
