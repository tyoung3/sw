#!/bin/bash 

# SWGRAPH  script.  Generate a jpg image from  a StreamWork .sw file(ND).

Die () {
	echo "$0/DIE: $*"
	exit 1
}


Debug() {
	a="a"
	# echo "Debug: $*"
}

SW=~/go/mod/sw/bin/sw
[ -e $SW     ] || Die $SW is missing 
$SW -v 

SearchFile() { 
	Debug SearchFIle $*
	echo looking for $swfile
	base=`basename $file`
	swfile=${base}
	
	if [ ! -f $swfile ]; then
		[ -f /home/tyoung3/go/mod/sw/nds/${swfile}.sw ] \
			&& swfile=/home/tyoung3/go/mod/sw/nds/${swfile}.sw
		[ -f $swfile ] || swfile=${file}.sw
	fi	
}

GenRun() {
	Debug GenRun  $file $*
	swfile=$file
	[ -f $file ] || searchFile  
	
	if [ -f $swfile ]; then
		Debug Got `pwd`/$swfile 
		$SW -m 3 $swfile > /tmp/${base}.dot || Die Cannot build .dot file
		dot -Tsvg /tmp/$base.dot > /tmp/${base}.svg || Die Cannot convert .dot file to .svg
		$BROWSER --new-window /tmp/${base}.svg	
	else 
		DIE $swfile missing
	fi
}

Run() {	
	for file in $*; do 
		GenRun $file
	done 
}

case $1 in 
	
	*)Run $*;;
esac	
